<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Guide to Accounting Principles</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.7.13/lottie.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Plus+Jakarta+Sans:wght@700;800&display=swap" rel="stylesheet">
    <style>
        /* Base styles for light mode */
        :root {
            --bg-color: #f1f5f9; /* Slate 100 */
            --text-color: #1e293b; /* Slate 900 */
            --card-bg-opacity: 0.8;
            --card-border-opacity: 0.3;
            --card-shadow-color: rgba(31, 38, 135, 0.1);
            --journal-bg: rgba(241, 245, 249, 0.7);
            --accordion-bg: rgba(255, 255, 255, 0.7);
            --accordion-border: rgba(255, 255, 255, 0.5);
            --tab-content-bg: #f8fafc; /* Slate 50 */
            --primary-gradient: linear-gradient(135deg, #6366f1, #8b5cf6, #d946ef); /* Updated gradient */
            --primary-color-start: #6366f1;
            --primary-color-end: #d946ef;
        }

        /* Dark mode styles */
        [data-theme="dark"] {
            --bg-color: #1a202c; /* Darker background */
            --text-color: #e2e8f0; /* Lighter text */
            --card-bg-opacity: 0.1; /* More transparent in dark mode */
            --card-border-opacity: 0.2;
            --card-shadow-color: rgba(0, 0, 0, 0.3);
            --journal-bg: rgba(30, 41, 59, 0.7); /* Darker journal background */
            --accordion-bg: rgba(45, 55, 72, 0.7);
            --accordion-border: rgba(45, 55, 72, 0.5);
            --tab-content-bg: #2d3748; /* Darker tab content */
            --primary-gradient: linear-gradient(135deg, #4f46e5, #7c3aed, #c026d3); /* Darker gradient for dark mode */
            --primary-color-start: #4f46e5;
            --primary-color-end: #c026d3;
        }

        html, body { overflow-x: hidden; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Fluid Typography */
        h1 { font-size: clamp(2.5rem, 6vw, 4.5rem); font-weight: 800; }
        h2 { font-size: clamp(2rem, 4.5vw, 3.5rem); font-weight: 700; }
        h3 { font-size: clamp(1.5rem, 3.5vw, 2.5rem); font-weight: 600; }
        p, li, span { font-size: clamp(1rem, 2vw, 1.125rem); } /* Adjusted for better readability */

        /* Custom Colors & Gradients */
        .bg-primary-gradient { background: var(--primary-gradient); }
        .text-primary-gradient {
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent; /* Fallback for non-webkit */
        }
        .bg-secondary-pink { background-color: #ec4899; }
        .text-secondary-pink { color: #ec4899; }
        .bg-secondary-amber { background-color: #f59e0b; }
        .text-secondary-amber { color: #f59e0b; }
        .border-white-30 { border-color: rgba(255, 255, 255, 0.3); }

        /* Glassmorphism Card */
        .glass-card {
            backdrop-filter: blur(16px); /* Increased blur */
            background: rgba(255, 255, 255, var(--card-bg-opacity)); /* Dynamic opacity */
            border: 1px solid rgba(255, 255, 255, var(--card-border-opacity)); /* Dynamic opacity */
            border-radius: 12px;
            box-shadow: 0 8px 32px 0 var(--card-shadow-color); /* Dynamic shadow */
            padding: 24px;
            margin-bottom: 24px;
            transition: all 300ms ease;
            width: 100%;
            box-sizing: border-box;
        }
        .glass-card:hover {
            transform: translateY(-8px) scale(1.01); /* Slightly less scale for subtlety */
            box-shadow: 0 12px 48px 0 rgba(31, 38, 135, 0.15); /* More prominent shadow */
        }

        /* Numbered Section Indicators */
        .section-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-gradient);
            color: white;
            font-weight: 700;
            font-size: 1.25rem;
            margin-right: 16px;
            flex-shrink: 0;
            box-shadow: 0 4px 10px rgba(79, 70, 229, 0.3);
        }

        /* Animated Tab Navigation */
        .tab-button {
            position: relative;
            padding: 12px 24px;
            font-weight: 600;
            color: var(--text-color); /* Use text color variable */
            transition: all 300ms ease;
            cursor: pointer;
            overflow: hidden;
            border-radius: 8px 8px 0 0;
            flex-grow: 1;
            text-align: center;
            opacity: 0.7; /* Subtle opacity for inactive */
        }
        .tab-button:hover {
            color: var(--primary-color-start); /* Use primary color */
            background-color: rgba(79, 70, 229, 0.05);
            opacity: 1;
        }
        .tab-button::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 4px;
            background: linear-gradient(to right, #ec4899, #f59e0b);
            transition: width 300ms ease, left 300ms ease;
        }
        .tab-button.active {
            color: var(--primary-color-start);
            background-color: rgba(79, 70, 229, 0.1);
            opacity: 1;
        }
        .tab-button.active::after {
            width: 100%;
            left: 0;
        }
        .tab-content-container { /* Container for tab content to allow GSAP animation */
            position: relative;
            min-height: 100px; /* Prevent content jump */
        }
        .tab-content-item {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            opacity: 0;
            visibility: hidden;
            background-color: var(--tab-content-bg);
            border-radius: 0 0 8px 8px;
            padding: 24px; /* Consistent padding */
            box-sizing: border-box;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: background-color 0.3s ease;
        }
        .tab-content-item.active {
            opacity: 1;
            visibility: visible;
            position: relative; /* Take up space when active */
            height: auto;
        }

        /* Journal Entries with Colored Left Border */
        .journal-entry-display {
            background-color: var(--journal-bg);
            border-left: 6px solid #52C41A;
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            width: 100%;
            box-sizing: border-box;
            overflow-x: auto; /* Allow horizontal scroll for long entries if necessary */
            transition: background-color 0.3s ease;
        }
        .journal-entry-display .account-row { /* Changed to account-row for better structure */
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            word-break: break-word;
        }
        .journal-entry-display .credit-account {
            padding-left: 32px;
        }

        /* Buttons with 3D Depth */
        .btn-primary, .step-button {
            background: var(--primary-gradient);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s ease-out; /* Faster transition for button feel */
            box-shadow: 0 4px 0px var(--primary-color-start), 0 6px 15px rgba(79, 70, 229, 0.3); /* Initial shadow */
            transform-style: preserve-3d; /* Enable 3D transforms for children */
            position: relative;
            z-index: 1;
        }
        .btn-primary:hover, .step-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0px var(--primary-color-start), 0 8px 20px rgba(79, 70, 229, 0.4); /* Lifted shadow */
        }
        .btn-primary:active, .step-button:active {
            transform: translateY(2px); /* Push down */
            box-shadow: 0 2px 0px var(--primary-color-start), 0 2px 5px rgba(79, 70, 229, 0.2); /* Pressed shadow */
        }
        .btn-primary:focus, .step-button:focus { outline: none; box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.5); }

        /* Accordion */
        .accordion-button {
            background-color: var(--accordion-bg);
            border: 1px solid var(--accordion-border);
            border-radius: 8px;
            padding: 16px 24px;
            font-weight: 600;
            color: var(--text-color);
            transition: all 300ms ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            width: 100%;
            text-align: left;
            box-sizing: border-box;
        }
        .accordion-button:hover {
            background-color: rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .accordion-button.active {
            background-color: rgba(79, 70, 229, 0.1);
            color: var(--primary-color-start);
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }
        .accordion-button.active svg { transform: rotate(180deg); }
        .accordion-content {
            background-color: var(--journal-bg); /* Use journal bg for consistency */
            border: 1px solid var(--accordion-border);
            border-top: none;
            border-radius: 0 0 8px 8px;
            padding: 16px 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            width: 100%;
            box-sizing: border-box;
            transition: background-color 0.3s ease;
        }

        /* Animations */
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(79, 70, 229, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(79, 70, 229, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(79, 70, 229, 0); }
        }
        .pulse-animation { animation: pulse 2s infinite; }

        /* Chart Container */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
            padding: 1rem;
            background-color: rgba(255, 255, 255, var(--card-bg-opacity));
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, var(--card-border-opacity));
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            overflow: hidden;
            box-sizing: border-box;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        @media (min-width: 768px) { .chart-container { height: 350px; } }

        /* Chatbox & AI Assistant */
        .chat-message { margin-bottom: 12px; padding: 12px 16px; border-radius: 20px; max-width: 80%; font-family: 'Inter', sans-serif; }
        .chat-message.user { background-color: #e0e7ff; align-self: flex-end; margin-left: auto; }
        .chat-message.ai { background-color: #e2e8f0; align-self: flex-start; }
        [data-theme="dark"] .chat-message.user { background-color: #4338ca; color: #e0e7ff; } /* Dark mode chat colors */
        [data-theme="dark"] .chat-message.ai { background-color: #334155; color: #e2e8f0; }

        /* Markdown specific styles for chatbox */
        .chat-message.ai strong { font-weight: 700; color: var(--primary-color-start); }
        .chat-message.ai em { font-style: italic; color: #f59e0b; }
        .chat-message.ai ul { list-style-type: disc; padding-left: 20px; margin-top: 5px; }
        .chat-message.ai ol { list-style-type: decimal; padding-left: 20px; margin-top: 5px; }
        .chat-message.ai li { margin-bottom: 4px; }
        .chat-message.ai p { margin-bottom: 8px; }


        .chat-loading { display: flex; align-items: center; justify-content: center; padding: 10px; }
        .spinner { border: 4px solid rgba(79, 70, 229, 0.2); border-left-color: #4f46e5; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        #openAiQuestionModalButton { /* Renamed from askAiButton */
            position: absolute;
            z-index: 9999;
            background: linear-gradient(to right, #ec4899, #f59e0b);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: none;
            white-space: nowrap;
            transition: all 300ms ease;
            transform: translateX(-50%);
        }
        #openAiQuestionModalButton:hover { transform: translateX(-50%) translateY(-3px) scale(1.05); box-shadow: 0 6px 16px rgba(0,0,0,0.2); }
        #openAiQuestionModalButton:active { transform: translateX(-50%) translateY(0); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        #openAiQuestionModalButton:focus { outline: none; box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.5); }

        #aiAssistantBubble {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 9999;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary-gradient);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        #aiAssistantBubble:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        #aiAssistantLottie {
            width: 100%;
            height: 100%;
        }

        /* Focus Mode for Journal Entry */
        .focus-mode-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .focus-mode-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .focus-mode-content {
            background: var(--bg-color);
            padding: 32px;
            border-radius: 12px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            transition: background-color 0.3s ease;
        }
        .focus-mode-close {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            font-size: 2rem;
            color: var(--text-color);
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .focus-mode-close:hover {
            color: #ef4444; /* Red 500 */
        }

        /* AI Question Modal Styles */
        #aiQuestionModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 10001; /* Higher than focus mode */
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        #aiQuestionModal.active {
            opacity: 1;
            visibility: visible;
        }
        .ai-modal-content {
            background: var(--bg-color);
            padding: 24px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            position: relative;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }
        #aiQuestionModal.active .ai-modal-content {
            transform: translateY(0);
        }
        .ai-modal-content h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--primary-color-start);
        }
        .ai-modal-content textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #cbd5e1; /* Slate 300 */
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            color: var(--text-color);
            background-color: var(--tab-content-bg);
            resize: vertical;
            min-height: 60px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }
        .ai-modal-content textarea:focus {
            outline: none;
            border-color: #6366f1; /* Indigo 500 */
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
        }
        .ai-modal-content .btn-group {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 20px;
        }
        .ai-modal-content .btn-group button {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .ai-modal-content .btn-group .btn-cancel {
            background-color: #ef4444; /* Red 500 */
            color: white;
            border: none;
        }
        .ai-modal-content .btn-group .btn-cancel:hover {
            background-color: #dc2626; /* Red 600 */
        }
        .ai-modal-content .btn-group .btn-ask {
            background: var(--primary-gradient);
            color: white;
            border: none;
        }
        .ai-modal-content .btn-group .btn-ask:hover {
            opacity: 0.9;
        }

        /* Dark Mode Toggle */
        #darkModeToggle {
            background-color: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        #darkModeToggle:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        [data-theme="dark"] #darkModeToggle {
            background-color: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(0, 0, 0, 0.3);
        }

        /* SVG Decorative Elements */
        .svg-divider {
            width: 100%;
            height: 50px; /* Adjust height as needed */
            margin: 40px 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .svg-divider svg {
            width: 80%;
            max-width: 600px;
            height: auto;
            fill: none;
            stroke: var(--primary-color-start);
            stroke-width: 2;
            stroke-dasharray: 10 5;
            transition: stroke 0.3s ease;
        }
        [data-theme="dark"] .svg-divider svg {
            stroke: var(--primary-color-end);
        }
    </style>
</head>
<body class="antialiased">

    <section class="bg-primary-gradient text-white py-16 px-4 text-center relative">
        <div class="container mx-auto">
            <div class="absolute top-4 right-4">
                <button id="darkModeToggle" class="flex items-center space-x-2">
                    <span id="darkModeIcon">‚òÄÔ∏è</span>
                    <span id="darkModeText">Light Mode</span>
                </button>
            </div>
            <h1 class="font-bold mb-4">Interactive Guide to Accounting Principles</h1>
            <p class="max-w-3xl mx-auto font-inter-regular">Master core accounting concepts from Receivables to Long-Lived Assets through clear explanations and interactive examples.</p>
        </div>
    </section>

    <div class="container mx-auto p-4 md:p-8">
        <section id="receivables" class="py-12">
            <h2 class="text-primary-gradient font-bold mb-6 flex items-center">
                <span class="section-badge">1</span> Understanding Receivables
            </h2>
            <p class="mb-8 font-inter-regular text-slate-700">Receivables represent money owed to a company. Effectively managing them is key to healthy cash flow. This section breaks down what they are, how they're recorded, and how their value is assessed.</p>

            <div class="glass-card">
                <h3 class="text-slate-800 font-semibold mb-4">What are Receivables?</h3>
                <p class="text-center text-slate-600"><span class="text-primary-gradient text-5xl font-bold">$$</span> <span class="text-3xl font-semibold font-plus-jakarta-sans">Expected from Customers</span></p>
                <p class="mt-4 font-inter-regular text-slate-700">Receivables are claims a company has against others, expected to be collected in cash. They primarily arise from selling goods or services.</p>
            </div>

            <div class="glass-card">
                <h3 class="text-slate-800 font-semibold mb-4">Types of Receivables</h3>
                <div class="grid md:grid-cols-3 gap-6 mt-4">
                    <div class="p-6 bg-slate-50 rounded-lg shadow-sm transition-transform duration-300 ease-in-out hover:scale-105">
                        <h4 class="font-bold text-xl text-indigo-700 mb-2">1. Accounts Receivable</h4>
                        <p class="font-inter-regular text-slate-600">Amounts customers owe on account for goods/services. Typically collected in 30-60 days. The most significant type.</p>
                    </div>
                    <div class="p-6 bg-slate-50 rounded-lg shadow-sm transition-transform duration-300 ease-in-out hover:scale-105">
                        <h4 class="font-bold text-xl text-pink-700 mb-2">2. Notes Receivable</h4>
                        <p class="font-inter-regular text-slate-600">Formal written promises of debt, often for 60-90+ days, usually with interest. From sales, they are 'trade receivables'.</p>
                    </div>
                    <div class="p-6 bg-slate-50 rounded-lg shadow-sm transition-transform duration-300 ease-in-out hover:scale-105">
                        <h4 class="font-bold text-xl text-amber-700 mb-2">3. Other Receivables</h4>
                        <p class="font-inter-regular text-slate-600">Nontrade items like interest receivable, loans to officers, tax refunds. Reported separately.</p>
                    </div>
                </div>
            </div>

            <div class="glass-card">
                <h3 class="text-slate-800 font-semibold mb-4">Recognizing Accounts Receivable: Jordache Co. Example</h3>
                <p class="font-inter-regular text-slate-700">Follow the journey of a sale on account, a return, and the final collection.</p>
                <div id="jordacheSteps" class="mt-4">
                    <div class="flex flex-wrap gap-2 mb-4">
                        <button class="step-button btn-primary" data-step="jordache1">Step 1: Sale</button>
                        <button class="step-button btn-primary" data-step="jordache2">Step 2: Return</button>
                        <button class="step-button btn-primary" data-step="jordache3">Step 3: Collection</button>
                    </div>
                    <div class="tab-content-container">
                        <div id="jordache1Content" class="step-content tab-content-item active journal-entry-display">
                            <h4 class="font-semibold text-slate-800">July 1: Sale on Account</h4>
                            <p class="account-row"><span>Accounts Receivable‚ÄîPolo Company</span><span>$1,000</span></p>
                            <p class="account-row credit-account"><span>Sales</span><span>$1,000</span></p>
                            <p class="text-sm text-slate-500 mt-1 font-inter-regular">(To record sales on account: Jordache Co. sells $1,000 merchandise to Polo Co., terms 2/10, n/30)</p>
                        </div>
                        <div id="jordache2Content" class="step-content tab-content-item journal-entry-display">
                            <h4 class="font-semibold text-slate-800">July 5: Merchandise Return</h4>
                            <p class="account-row"><span>Sales Returns and Allowances</span><span>$100</span></p>
                            <p class="account-row credit-account"><span>Accounts Receivable‚ÄîPolo Company</span><span>$100</span></p>
                            <p class="text-sm text-slate-500 mt-1 font-inter-regular">(To record merchandise returned: Polo returns $100 worth of merchandise)</p>
                        </div>
                        <div id="jordache3Content" class="step-content tab-content-item journal-entry-display">
                            <h4 class="font-semibold text-slate-800">July 11: Collection of Accounts Receivable</h4>
                            <p class="account-row"><span>Cash ($900 - $18 discount)</span><span>$882</span></p>
                            <p class="account-row"><span>Sales Discounts ($900 √ó 0.02)</span><span>$18</span></p>
                            <p class="account-row credit-account"><span>Accounts Receivable‚ÄîPolo Company</span><span>$900</span></p>
                            <p class="text-sm text-slate-500 mt-1 font-inter-regular">(To record collection: Jordache receives payment, taking advantage of the 2% discount)</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="glass-card">
                <h3 class="text-slate-800 font-semibold mb-4">Valuing Accounts Receivable</h3>
                <p class="text-center text-slate-600"><span class="text-secondary-pink text-5xl font-bold">‚ö†Ô∏è</span> <span class="text-3xl font-semibold font-plus-jakarta-sans">Some Won't Pay</span></p>
                <p class="mt-4 font-inter-regular text-slate-700">Unfortunately, not all receivables are collected. Companies must account for these 'uncollectible accounts' or 'bad debts'.</p>
                <div class="grid md:grid-cols-2 gap-6 mt-6">
                    <div class="w-full">
                        <h4 class="font-semibold text-xl text-slate-800 mb-2">Direct Write-Off Method</h4>
                        <p class="font-inter-regular text-slate-700">Bad debt expense is recorded <span class="font-bold">only when</span> a specific account is deemed uncollectible. Simple, but has drawbacks:</p>
                        <ul class="list-disc list-inside text-sm mt-2 pl-4 text-slate-600 font-inter-regular">
                            <li>Poor matching of expenses with revenues.</li>
                            <li>Receivables not stated at cash realizable value.</li>
                            <li>Not GAAP/IFRS compliant if material.</li>
                        </ul>
                         <div class="journal-entry-display mt-4">
                            <h5 class="font-medium text-slate-800">Example: Warden Co. writes off Doran's $200</h5>
                            <p class="account-row"><span>Bad Debts Expense</span><span>$200</span></p>
                            <p class="account-row credit-account"><span>Accounts Receivable‚ÄîM. E. Doran</span><span>$200</span></p>
                        </div>
                    </div>
                    <div class="w-full">
                        <h4 class="font-semibold text-xl text-slate-800 mb-2">Allowance Method</h4>
                        <p class="font-inter-regular text-slate-700">Estimates uncollectible accounts <span class="font-bold">each period</span>. Better matches expenses and revenues. Uses 'Allowance for Doubtful Accounts' (a contra-asset).</p>
                        <div class="chart-container mt-4 h-48 md:h-56">
                             <canvas id="allowanceEstimateChart"></canvas>
                        </div>
                        <p class="text-center text-sm mt-2 text-slate-600 font-inter-regular">Visualizing Estimated Uncollectibles</p>
                    </div>
                </div>

                <h4 class="font-semibold text-xl text-slate-800 mt-8 mb-4">Allowance Method in Detail</h4>
                <div id="allowanceTabs" class="mt-4 border-b border-slate-300">
                    <div class="flex flex-wrap">
                        <button class="tab-button allowance-tab active" data-tab="allowanceEst">Recording Estimate</button>
                        <button class="tab-button allowance-tab" data-tab="allowanceWriteOff">Write-Off</button>
                        <button class="tab-button allowance-tab" data-tab="allowanceRecovery">Recovery</button>
                    </div>
                    <div class="tab-content-container">
                        <div id="allowanceEstContent" class="tab-content-item active">
                            <p class="font-inter-regular text-slate-700">Estimate uncollectible based on experience (e.g., Hampson Furniture estimates $12,000).</p>
                            <div class="journal-entry-display mt-4">
                                 <p class="account-row"><span>Bad Debts Expense</span><span>$12,000</span></p>
                                 <p class="account-row credit-account"><span>Allowance for Doubtful Accounts</span><span>$12,000</span></p>
                            </div>
                        </div>
                        <div id="allowanceWriteOffContent" class="tab-content-item">
                            <p class="font-inter-regular text-slate-700">When a specific account is confirmed uncollectible (e.g., R.A. Ware's $500).</p>
                            <div class="journal-entry-display mt-4">
                                <p class="account-row"><span>Allowance for Doubtful Accounts</span><span>$500</span></p>
                                <p class="account-row credit-account"><span>Accounts Receivable‚ÄîR. A. Ware</span><span>$500</span></p>
                            </div>
                             <p class="text-xs text-slate-500 mt-2 font-inter-regular">Note: This does not affect Bad Debts Expense or Net AR at the time of write-off.</p>
                        </div>
                        <div id="allowanceRecoveryContent" class="tab-content-item">
                            <p class="font-inter-regular text-slate-700">If a previously written-off account is collected (e.g., R.A. Ware pays $500).</p>
                            <div class="journal-entry-display mt-4">
                                <h5 class="font-medium text-slate-800">1. Reverse Write-Off:</h5>
                                <p class="account-row"><span>Accounts Receivable‚ÄîR. A. Ware</span><span>$500</span></p>
                                <p class="account-row credit-account"><span>Allowance for Doubtful Accounts</span><span>$500</span></p>
                            </div>
                            <div class="journal-entry-display mt-4">
                                <h5 class="font-medium text-slate-800">2. Record Collection:</h5>
                                <p class="account-row"><span>Cash</span><span>$500</span></p>
                                <p class="account-row credit-account"><span>Accounts Receivable‚ÄîR. A. Ware</span><span>$500</span></p>
                            </div>
                        </div>
                    </div>
                </div>

                <h4 class="font-semibold text-xl text-slate-800 mt-8 mb-4">Bases for Allowance Method Estimate</h4>
                <div class="grid md:grid-cols-2 gap-6 mt-4">
                    <div class="p-6 border border-slate-200 rounded-lg bg-slate-50 shadow-sm transition-transform duration-300 ease-in-out hover:scale-105">
                        <h5 class="font-bold text-lg text-amber-600">Percentage of Sales</h5>
                        <p class="font-inter-regular text-slate-700">Estimates a % of credit sales as uncollectible. Focuses on matching expense to revenue (Income Statement focus).</p>
                        <p class="text-sm mt-2 font-inter-regular">E.g., 1% of $800,000 net credit sales = $8,000 Bad Debts Expense.</p>
                    </div>
                    <div class="p-6 border border-slate-200 rounded-lg bg-slate-50 shadow-sm transition-transform duration-300 ease-in-out hover:scale-105">
                        <h5 class="font-bold text-lg text-amber-600">Percentage of Receivables / Aging Schedule</h5>
                        <p class="font-inter-regular text-slate-700">Estimates % of outstanding receivables as uncollectible, often using an aging schedule. Focuses on Net Realizable Value of receivables (Balance Sheet focus).</p>
                         <div class="chart-container mt-4">
                            <canvas id="agingScheduleChart"></canvas>
                        </div>
                        <p class="text-center text-sm mt-2 text-slate-600 font-inter-regular">Aging Schedule: Older debts, higher uncollectible %.</p>
                    </div>
                </div>
            </div>
        </section>

        <div class="svg-divider">
            <svg viewBox="0 0 100 10">
                <path d="M0 5 Q25 0 50 5 T100 5" />
            </svg>
        </div>

        <section id="liabilities" class="py-12">
            <h2 class="text-primary-gradient font-bold mb-6 flex items-center">
                <span class="section-badge">2</span> Managing Liabilities
            </h2>
            <p class="mb-8 font-inter-regular text-slate-700">Liabilities are a company's obligations. Current liabilities are those due within one year or the operating cycle. Proper management is vital for solvency.</p>

            <div class="glass-card">
                <h3 class="text-slate-800 font-semibold mb-4">What are Current Liabilities?</h3>
                <p class="text-center text-slate-600"><span class="text-secondary-amber text-5xl font-bold">üí∏</span> <span class="text-3xl font-semibold font-plus-jakarta-sans">Short-Term Obligations</span></p>
                <p class="mt-4 font-inter-regular text-slate-700">Debts a company expects to pay within one year or its operating cycle, using current assets or by creating other current liabilities.</p>
            </div>

            <div class="glass-card">
                <h3 class="text-slate-800 font-semibold mb-4">Common Types of Current Liabilities</h3>
                <div class="space-y-4 mt-4">
                    <div class="accordion-item">
                        <button class="accordion-button w-full flex justify-between items-center">
                            <span>üõí Accounts Payable</span>
                            <svg class="w-6 h-6 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content hidden">Amounts owed to suppliers for goods/services on credit.</div>
                    </div>
                     <div class="accordion-item">
                        <button class="accordion-button w-full flex justify-between items-center">
                            <span>üìÖ Accrued Expenses</span>
                            <svg class="w-6 h-6 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content hidden">Expenses incurred but not yet paid (e.g., salaries, rent).</div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-button w-full flex justify-between items-center">
                            <span>üéÅ Unearned Revenue</span>
                            <svg class="w-6 h-6 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content hidden">Revenue received but not yet earned (e.g., advance payments for services).</div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-button w-full flex justify-between items-center">
                            <span>‚úçÔ∏è Notes Payable (Short-Term)</span>
                            <svg class="w-6 h-6 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content hidden">Formal written promises to pay a specific amount, usually with interest, due within one year.</div>
                    </div>
                </div>
            </div>

            <div class="glass-card">
                <h3 class="text-slate-800 font-semibold mb-4">Notes Payable Explained: Cole Williams Co. Example</h3>
                <p class="font-inter-regular text-slate-700">A note payable is a formal written promise to pay, often with interest. Here's how it's recorded:</p>
                 <div id="coleSteps" class="mt-4">
                    <div class="flex flex-wrap gap-2 mb-4">
                        <button class="step-button btn-primary" data-step="cole1">Issuance</button>
                        <button class="step-button btn-primary" data-step="cole2">Interest Accrual</button>
                        <button class="step-button btn-primary" data-step="cole3">Maturity Payment</button>
                    </div>
                    <div class="tab-content-container">
                        <div id="cole1Content" class="step-content tab-content-item active journal-entry-display">
                            <h4 class="font-semibold text-slate-800">March 1: Issuance of Note</h4>
                            <p class="account-row"><span>Cash</span><span>$100,000</span></p>
                            <p class="account-row credit-account"><span>Notes Payable</span><span>$100,000</span></p>
                            <p class="text-sm text-slate-500 mt-1 font-inter-regular">(Cole Williams Co. signs a $100,000, 12%, 4-month note)</p>
                        </div>
                        <div id="cole2Content" class="step-content tab-content-item journal-entry-display">
                            <h4 class="font-semibold text-slate-800">June 30: Accrued Interest (Financial Statements Date)</h4>
                            <p class="text-sm mb-1 font-inter-regular">Interest: $100,000 √ó 12% √ó 4/12 = $4,000</p>
                            <p class="account-row"><span>Interest Expense</span><span>$4,000</span></p>
                            <p class="account-row credit-account"><span>Interest Payable</span><span>$4,000</span></p>
                        </div>
                        <div id="cole3Content" class="step-content tab-content-item journal-entry-display">
                            <h4 class="font-semibold text-slate-800">July 1: Payment at Maturity</h4>
                            <p class="account-row"><span>Notes Payable</span><span>$100,000</span></p>
                            <p class="account-row"><span>Interest Payable</span><span>$4,000</span></p>
                            <p class="account-row credit-account"><span>Cash</span><span>$104,000</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div class="svg-divider">
            <svg viewBox="0 0 100 10">
                <path d="M0 5 Q25 10 50 5 T100 5" />
            </svg>
        </div>

        <section id="longLivedAssets" class="py-12">
            <h2 class="text-primary-gradient font-bold mb-6 flex items-center">
                <span class="section-badge">3</span> Long-Lived Assets & Their Costs
            </h2>
            <p class="mb-8 font-inter-regular text-slate-700">These assets provide benefits for multiple years. Their costs are systematically allocated to expenses over their useful lives through depreciation, depletion, or amortization.</p>

            <div class="grid md:grid-cols-3 gap-6 mb-8">
                <div class="glass-card flex flex-col items-center text-center">
                    <span class="text-5xl mb-2">üè¢</span>
                    <h3 class="text-slate-800 text-xl font-semibold !mt-0">Plant Assets</h3>
                    <p class="font-inter-regular text-slate-600">Physical assets like buildings & equipment. Cost allocated via <span class="font-semibold text-secondary-pink">Depreciation</span>.</p>
                </div>
                <div class="glass-card flex flex-col items-center text-center">
                    <span class="text-5xl mb-2">üå≥</span>
                     <h3 class="text-slate-800 text-xl font-semibold !mt-0">Natural Resources</h3>
                    <p class="font-inter-regular text-slate-600">Assets like timber & minerals. Cost allocated via <span class="font-semibold text-secondary-amber">Depletion</span>.</p>
                </div>
                <div class="glass-card flex flex-col items-center text-center">
                    <span class="text-5xl mb-2">üí°</span>
                    <h3 class="text-slate-800 text-xl font-semibold !mt-0">Intangible Assets</h3>
                    <p class="font-inter-regular text-slate-600">Non-physical assets like patents & copyrights. Cost allocated via <span class="font-semibold text-primary-gradient">Amortization</span>.</p>
                </div>
            </div>

            <div class="glass-card">
                <h3 class="text-slate-800 font-semibold mb-4">Plant Assets & Depreciation</h3>
                 <p class="text-center text-slate-600"><span class="text-secondary-pink text-5xl font-bold">‚öôÔ∏è</span> <span class="text-3xl font-semibold font-plus-jakarta-sans">Asset Cost Allocation</span></p>
                <p class="mt-4 font-inter-regular text-slate-700">Depreciation is spreading a tangible asset's cost over its useful life. Land is not depreciated.</p>

                <h4 class="font-semibold text-xl text-slate-800 mt-6 mb-4">Factors in Computing Depreciation:</h4>
                <ul class="space-y-2 font-inter-regular text-slate-700">
                    <li class="flex items-center"><span class="text-secondary-amber text-2xl mr-3">üí≤</span> Cost: Original purchase price.</li>
                    <li class="flex items-center"><span class="text-secondary-amber text-2xl mr-3">‚è≥</span> Useful Life: Estimated productive life.</li>
                    <li class="flex items-center"><span class="text-secondary-amber text-2xl mr-3">‚ôªÔ∏è</span> Salvage Value: Estimated value at end of useful life.</li>
                </ul>

                <h4 class="font-semibold text-xl text-slate-800 mt-6 mb-4">Depreciation Methods:</h4>
                 <div id="depreciationTabs" class="mt-4 border-b border-slate-300">
                    <div class="flex flex-wrap">
                        <button class="tab-button depr-tab active" data-tab="deprStraight">Straight-Line</button>
                        <button class="tab-button depr-tab" data-tab="deprActivity">Units-of-Activity</button>
                        <button class="tab-button depr-tab" data-tab="deprDeclining">Declining-Balance</button>
                    </div>
                    <div class="tab-content-container">
                        <div id="deprStraightContent" class="tab-content-item active">
                            <h5 class="font-bold text-slate-800 text-lg">Straight-Line Method</h5>
                            <p class="font-inter-regular text-slate-700">Same depreciation expense each year.</p>
                            <p class="text-sm font-mono mt-2 bg-slate-100 p-2 rounded text-slate-800">Formula: (Cost - Salvage Value) / Useful Life</p>
                        </div>
                        <div id="deprActivityContent" class="tab-content-item">
                            <h5 class="font-bold text-slate-800 text-lg">Units-of-Activity Method</h5>
                            <p class="font-inter-regular text-slate-700">Based on actual usage or production.</p>
                            <p class="text-sm font-mono mt-2 bg-slate-100 p-2 rounded text-slate-800">Rate = (Cost - Salvage) / Total Units. Expense = Rate √ó Units This Period.</p>
                        </div>
                        <div id="deprDecliningContent" class="tab-content-item">
                            <h5 class="font-bold text-slate-800 text-lg">Declining-Balance Method</h5>
                            <p class="font-inter-regular text-slate-700">Accelerated method; higher expense in early years. Uses a multiple of the straight-line rate on the declining book value.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-6 mt-8">
                <div class="glass-card">
                    <h3 class="text-slate-800 font-semibold mb-4">Natural Resources & Depletion</h3>
                    <p class="font-inter-regular text-slate-700">Depletion allocates the cost of natural resources (e.g., oil, gas, minerals) over their extraction period.</p>
                    <p class="text-sm font-mono mt-4 bg-slate-100 p-2 rounded text-slate-800">Cost/Unit = (Total Cost - Salvage) / Total Est. Units</p>
                    <p class="text-sm font-mono mt-2 bg-slate-100 p-2 rounded text-slate-800">Annual Expense = Cost/Unit √ó Units Extracted & Sold</p>
                </div>
                <div class="glass-card">
                    <h3 class="text-slate-800 font-semibold mb-4">Intangible Assets & Amortization</h3>
                    <p class="font-inter-regular text-slate-700">Amortization allocates the cost of intangible assets (patents, copyrights) over their useful lives. Goodwill is tested for impairment, not amortized.</p>
                    <h5 class="font-semibold text-slate-800 mt-4">Common Types:</h5>
                    <ul class="list-disc list-inside text-slate-700 text-base mt-2 pl-4">
                        <li>Patents (exclusive invention rights)</li>
                        <li>Copyrights (literary/artistic works)</li>
                        <li>Trademarks (logos, brand names)</li>
                        <li>Franchises & Leases</li>
                    </ul>
                     <p class="text-xs text-slate-500 mt-4 font-inter-regular">Recorded at historical cost.</p>
                </div>
            </div>
        </section>

        <div class="svg-divider">
            <svg viewBox="0 0 100 10">
                <path d="M0 5 C25 15 75 -5 100 5" />
            </svg>
        </div>

        <section class="py-12">
            <h2 class="text-primary-gradient font-bold mb-6 flex items-center">
                <span class="section-badge">4</span> Journal Entry Generator ‚ú®
            </h2>
            <p class="mb-8 font-inter-regular text-slate-700">Describe a financial transaction, and Gemini will generate the corresponding journal entry for you! This interactive tool helps you practice and understand the mechanics of double-entry accounting.</p>
            <div class="glass-card">
                <div class="flex flex-col md:flex-row gap-4 mb-4">
                    <input type="text" id="transactionDescription" class="flex-1 p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 font-inter-regular text-slate-800" placeholder="e.g., Purchased office supplies for $200 cash">
                    <button id="generateEntryButton" class="btn-primary pulse-animation">Generate Journal Entry ‚ú®</button>
                </div>
                <div id="entryLoading" class="chat-loading hidden">
                    <div class="spinner"></div>
                    <span class="ml-2 text-slate-600 font-inter-regular">Generating...</span>
                </div>
                <div id="generatedEntryOutput" class="journal-entry-display hidden">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="font-semibold text-lg text-slate-800 !mb-0">Generated Journal Entry:</h3>
                        <button id="focusModeToggle" class="btn-primary !py-2 !px-4 !text-sm">Focus Mode</button>
                    </div>
                    <div id="entryAccounts"></div>
                    <p id="entryDescription" class="description text-slate-600 font-inter-regular"></p>
                </div>
            </div>
        </section>

        <section class="py-12">
            <h2 class="text-primary-gradient font-bold mb-6 flex items-center">
                <span class="section-badge">5</span> Gemini Responses
            </h2>
            <p class="mb-8 font-inter-regular text-slate-700">Select any text on the page to make an "Ask AI" button appear. Click it to get an explanation from Gemini in the chat history below. This allows for contextual learning and deeper dives into specific concepts.</p>
            <div class="glass-card">
                <div id="chatbox" class="h-80 overflow-y-auto border border-slate-300 rounded-lg p-4 mb-4 flex flex-col space-y-3 bg-slate-50">
                    <div class="chat-message ai">Hello! Select any text on the page to ask me a question.</div>
                </div>
                <div id="chatLoading" class="chat-loading hidden">
                    <div class="spinner"></div>
                    <span class="ml-2 text-slate-600 font-inter-regular">Thinking...</span>
                </div>
            </div>
        </section>

        <footer class="text-center py-8 mt-12 border-t border-slate-300">
            <p class="text-sm text-slate-500 font-inter-regular">&copy; <span id="currentYear"></span> Accounting Principles Infographic. For educational purposes based on Management and Accounting Notes.</p>
        </footer>

    </div>

    <div id="openAiQuestionModalButton" class="hidden">Ask AI</div>

    <div id="aiAssistantBubble">
        <div id="aiAssistantLottie"></div>
    </div>

    <div id="focusModeOverlay" class="focus-mode-overlay">
        <div class="focus-mode-content">
            <button id="focusModeClose" class="focus-mode-close">&times;</button>
            <h3 class="font-semibold text-xl text-slate-800 mb-4">Journal Entry in Focus:</h3>
            <div id="focusedEntryContent" class="journal-entry-display">
                </div>
        </div>
    </div>

    <div id="aiQuestionModal" class="hidden">
        <div class="ai-modal-content glass-card">
            <h3 class="text-primary-gradient">Ask Gemini about the selected text</h3>
            <label for="selectedTextDisplay" class="block text-sm font-medium text-slate-700 mb-1">Selected Text (for context):</label>
            <textarea id="selectedTextDisplay" class="mb-4" rows="3" readonly></textarea>

            <label for="userQuestionInput" class="block text-sm font-medium text-slate-700 mb-1">Your Question:</label>
            <textarea id="userQuestionInput" placeholder="e.g., What is the difference between these two?" rows="2"></textarea>

            <div class="btn-group">
                <button id="cancelAiQuestion" class="btn-cancel">Cancel</button>
                <button id="sendAiQuestion" class="btn-ask">Ask Gemini</button>
            </div>
        </div>
    </div>

<script>
    // Dark Mode Toggle
    const darkModeToggle = document.getElementById('darkModeToggle');
    const darkModeIcon = document.getElementById('darkModeIcon');
    const darkModeText = document.getElementById('darkModeText');

    const setDarkMode = (isDark) => {
        if (isDark) {
            document.documentElement.setAttribute('data-theme', 'dark');
            localStorage.setItem('theme', 'dark');
            darkModeIcon.textContent = 'üåô';
            darkModeText.textContent = 'Dark Mode';
        } else {
            document.documentElement.removeAttribute('data-theme');
            localStorage.setItem('theme', 'light');
            darkModeIcon.textContent = '‚òÄÔ∏è';
            darkModeText.textContent = 'Light Mode';
        }
    };

    // Check for saved theme preference
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
        setDarkMode(true);
    } else {
        setDarkMode(false); // Default to light mode if no preference or 'light'
    }

    darkModeToggle.addEventListener('click', () => {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        setDarkMode(currentTheme !== 'dark');
    });

    // GSAP Tab Transitions
    function setupTabs(containerElementId, tabSelector, contentSelectorPrefix, activeClass) {
        const tabs = document.querySelectorAll(`#${containerElementId} ${tabSelector}`);
        const tabContentContainer = document.querySelector(`#${containerElementId} .tab-content-container`);

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const currentActiveContent = document.querySelector(`#${containerElementId} .tab-content-item.active`);

                // Remove active class from all tabs
                tabs.forEach(t => t.classList.remove(activeClass));
                // Add active class to clicked tab
                tab.classList.add(activeClass);

                const targetContentId = contentSelectorPrefix + tab.dataset.tab.charAt(0).toUpperCase() + tab.dataset.tab.slice(1) + 'Content';
                const targetContent = document.getElementById(targetContentId);

                if (currentActiveContent && currentActiveContent !== targetContent) {
                    // Animate out current content
                    gsap.to(currentActiveContent, {
                        opacity: 0,
                        y: -20,
                        duration: 0.3,
                        onComplete: () => {
                            currentActiveContent.classList.remove('active');
                            currentActiveContent.style.display = 'none'; // Hide after animation
                            if (targetContent) {
                                targetContent.style.display = 'block'; // Show before animating in
                                // Animate in new content
                                gsap.fromTo(targetContent,
                                    { opacity: 0, y: 20 },
                                    { opacity: 1, y: 0, duration: 0.3, onComplete: () => {
                                        targetContent.classList.add('active');
                                        // Adjust container height after animation for better flow
                                        if (tabContentContainer) {
                                            gsap.to(tabContentContainer, { height: targetContent.offsetHeight, duration: 0.2 });
                                        }
                                    } }
                                );
                            }
                        }
                    });
                } else if (targetContent && !currentActiveContent) {
                    // Initial animation for the first active tab
                    targetContent.style.display = 'block';
                    gsap.fromTo(targetContent,
                        { opacity: 0, y: 20 },
                        { opacity: 1, y: 0, duration: 0.3, onComplete: () => {
                            targetContent.classList.add('active');
                            if (tabContentContainer) {
                                gsap.set(tabContentContainer, { height: targetContent.offsetHeight }); // Set initial height
                            }
                        } }
                    );
                }

                 // Adjust container height immediately for smooth transition
                 if (tabContentContainer && targetContent) {
                    gsap.to(tabContentContainer, { height: targetContent.offsetHeight, duration: 0.2 });
                 }
            });
        });

        // Set initial height for the container based on the active tab
        const initialActiveContent = document.querySelector(`#${containerElementId} .tab-content-item.active`);
        if (tabContentContainer && initialActiveContent) {
            gsap.set(tabContentContainer, { height: initialActiveContent.offsetHeight });
        }
    }

    setupTabs('allowanceTabs', '.allowance-tab', 'allowance', 'active');
    setupTabs('depreciationTabs', '.depr-tab', 'depr', 'active');

    // Setup for step-based content (Jordache, Cole) - now uses GSAP for transitions
    function setupSteps(containerId, buttonClass, contentClassPrefix) {
        const stepButtons = document.querySelectorAll(`#${containerId} .${buttonClass}`);
        const stepContentContainer = document.querySelector(`#${containerId} .tab-content-container`);

        stepButtons.forEach(button => {
            button.addEventListener('click', () => {
                const currentActiveContent = document.querySelector(`#${containerId} .step-content.active`);

                // Remove active class from all buttons and content
                stepButtons.forEach(btn => {
                    btn.classList.remove('bg-secondary-amber');
                    btn.classList.remove('btn-primary'); // Remove primary style to allow secondary color
                    btn.classList.add('bg-slate-200', 'text-slate-700'); // Inactive style
                });

                // Add active class to clicked button
                button.classList.add('btn-primary'); // Re-add primary style
                button.classList.remove('bg-slate-200', 'text-slate-700'); // Remove inactive style

                const targetContentId = contentClassPrefix + button.dataset.step.slice(-1) + 'Content';
                const targetContent = document.getElementById(targetContentId);

                if (currentActiveContent && currentActiveContent !== targetContent) {
                    gsap.to(currentActiveContent, {
                        opacity: 0,
                        y: -20,
                        duration: 0.3,
                        onComplete: () => {
                            currentActiveContent.classList.remove('active');
                            currentActiveContent.style.display = 'none';
                            if (targetContent) {
                                targetContent.style.display = 'block';
                                gsap.fromTo(targetContent,
                                    { opacity: 0, y: 20 },
                                    { opacity: 1, y: 0, duration: 0.3, onComplete: () => {
                                        targetContent.classList.add('active');
                                        if (stepContentContainer) {
                                            gsap.to(stepContentContainer, { height: targetContent.offsetHeight, duration: 0.2 });
                                        }
                                    } }
                                );
                            }
                        }
                    });
                } else if (targetContent && !currentActiveContent) {
                    targetContent.style.display = 'block';
                    gsap.fromTo(targetContent,
                        { opacity: 0, y: 20 },
                        { opacity: 1, y: 0, duration: 0.3, onComplete: () => {
                            targetContent.classList.add('active');
                            if (stepContentContainer) {
                                gsap.set(stepContentContainer, { height: targetContent.offsetHeight });
                            }
                        } }
                    );
                }

                if (stepContentContainer && targetContent) {
                    gsap.to(stepContentContainer, { height: targetContent.offsetHeight, duration: 0.2 });
                }
            });
        });

        // Initialize the first step
        if (stepButtons.length > 0) {
            stepButtons[0].click(); // Simulate click on the first button to activate it
        }
    }
    setupSteps('jordacheSteps', 'step-button', 'jordache');
    setupSteps('coleSteps', 'step-button', 'cole');


    const accordionItems = document.querySelectorAll('.accordion-item');
    accordionItems.forEach(item => {
        const button = item.querySelector('.accordion-button');
        const content = item.querySelector('.accordion-content');
        button.addEventListener('click', () => {
            const isActive = button.classList.toggle('active');
            if (isActive) {
                gsap.fromTo(content, { height: 0, opacity: 0, y: -10 }, { height: 'auto', opacity: 1, y: 0, duration: 0.3, ease: "power2.out", onComplete: () => content.style.display = 'block' });
                content.style.display = 'block'; // Ensure it's visible for height calculation
            } else {
                gsap.to(content, { height: 0, opacity: 0, y: -10, duration: 0.3, ease: "power2.in", onComplete: () => content.style.display = 'none' });
            }
        });
        // Initially hide content
        content.style.display = 'none';
        content.style.overflow = 'hidden'; // Prevent content overflow during animation
    });

    document.getElementById('currentYear').textContent = new Date().getFullYear();

    const chartJsTooltipCallbacks = {
        title: function(tooltipItems) {
            const item = tooltipItems[0];
            let label = item.chart.data.labels[item.dataIndex];
            if (Array.isArray(label)) {
                return label.join(' ');
            }
            return label;
        }
    };

    function wrapChartLabels(label, maxLength = 16) {
        if (typeof label !== 'string' || label.length <= maxLength) {
            return label;
        }
        const words = label.split(' ');
        const lines = [];
        let currentLine = '';
        for (const word of words) {
            if ((currentLine + word).length > maxLength && currentLine.length > 0) {
                lines.push(currentLine.trim());
                currentLine = '';
            }
            currentLine += word + ' ';
        }
        if (currentLine.trim().length > 0) {
            lines.push(currentLine.trim());
        }
        return lines.length > 0 ? lines : [label];
    }

    // Chart.js with dynamic gradients
    function createGradient(ctx, chartArea, colorStart, colorEnd) {
        const gradient = ctx.createLinearGradient(0, chartArea.bottom, 0, chartArea.top);
        gradient.addColorStop(0, colorStart);
        gradient.addColorStop(1, colorEnd);
        return gradient;
    }

    let allowanceEstimateChartInstance = null;
    const allowanceEstimateCtx = document.getElementById('allowanceEstimateChart')?.getContext('2d');
    if (allowanceEstimateCtx) {
        allowanceEstimateChartInstance = new Chart(allowanceEstimateCtx, {
            type: 'doughnut',
            data: {
                labels: ['Estimated Collectible AR', 'Estimated Uncollectible AR'],
                datasets: [{
                    label: 'Accounts Receivable Status',
                    data: [188000, 12000],
                    backgroundColor: [
                        function(context) {
                            const chart = context.chart;
                            const {ctx, chartArea} = chart;
                            if (!chartArea) return;
                            return createGradient(ctx, chartArea, '#6366f1', '#8b5cf6'); /* Primary gradient */
                        },
                        function(context) {
                            const chart = context.chart;
                            const {ctx, chartArea} = chart;
                            if (!chartArea) return;
                            return createGradient(ctx, chartArea, '#ec4899', '#f59e0b'); /* Secondary gradient */
                        }
                    ],
                    borderColor: ['#FFFFFF', '#FFFFFF'],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: {
                    duration: 1000,
                    easing: 'easeOutQuart'
                },
                plugins: {
                    legend: { position: 'bottom', labels: { color: 'var(--text-color)', font: { family: 'Inter' } } },
                    title: { display: true, text: 'AR: Collectible vs. Uncollectible Estimate', color: 'var(--text-color)', font: { family: 'Plus Jakarta Sans', size: 14 } },
                    tooltip: { callbacks: chartJsTooltipCallbacks }
                }
            }
        });
    }

    let agingScheduleChartInstance = null;
    const agingScheduleCtx = document.getElementById('agingScheduleChart')?.getContext('2d');
    if (agingScheduleCtx) {
        const agingLabels = ['Not Yet Due', '1-30 Days Past Due', '31-60 Days Past Due', '61-90 Days Past Due', 'Over 90 Days Past Due'];
        agingScheduleChartInstance = new Chart(agingScheduleCtx, {
            type: 'bar',
            data: {
                labels: agingLabels.map(label => wrapChartLabels(label)),
                datasets: [
                    {
                        label: 'AR Amount ($)',
                        data: [27000, 5700, 3000, 2000, 1900],
                        backgroundColor: function(context) {
                            const chart = context.chart;
                            const {ctx, chartArea} = chart;
                            if (!chartArea) return;
                            return createGradient(ctx, chartArea, '#6366f1', '#8b5cf6');
                        },
                        borderColor: '#3730a3',
                        borderWidth: 1
                    },
                    {
                        label: 'Estimated Uncollectible ($)',
                        data: [540, 228, 300, 400, 760],
                        backgroundColor: function(context) {
                            const chart = context.chart;
                            const {ctx, chartArea} = chart;
                            if (!chartArea) return;
                            return createGradient(ctx, chartArea, '#ec4899', '#f59e0b');
                        },
                        borderColor: '#be185d',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: {
                    duration: 1200,
                    easing: 'easeOutExpo'
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'Amount ($)', color: 'var(--text-color)', font: { family: 'Inter' } },
                        ticks: { color: 'var(--text-color)', font: { family: 'Inter' } }
                    },
                    x: {
                        ticks: { color: 'var(--text-color)', maxRotation: 0, autoSkip: false, font: { family: 'Inter' } }
                    }
                },
                plugins: {
                    legend: { position: 'top', labels: { color: 'var(--text-color)', font: { family: 'Inter' } } },
                    title: { display: true, text: 'Accounts Receivable Aging Schedule', color: 'var(--text-color)', font: { family: 'Plus Jakarta Sans', size: 14 }},
                    tooltip: { mode: 'index', intersect: false, callbacks: chartJsTooltipCallbacks }
                }
            }
        });
    }

    // Update charts on theme change
    const updateChartColors = () => {
        if (allowanceEstimateChartInstance) {
            allowanceEstimateChartInstance.options.plugins.legend.labels.color = getComputedStyle(document.documentElement).getPropertyValue('--text-color');
            allowanceEstimateChartInstance.options.plugins.title.color = getComputedStyle(document.documentElement).getPropertyValue('--text-color');
            allowanceEstimateChartInstance.update();
        }
        if (agingScheduleChartInstance) {
            agingScheduleChartInstance.options.scales.y.title.color = getComputedStyle(document.documentElement).getPropertyValue('--text-color');
            agingScheduleChartInstance.options.scales.y.ticks.color = getComputedStyle(document.documentElement).getPropertyValue('--text-color');
            agingScheduleChartInstance.options.scales.x.ticks.color = getComputedStyle(document.documentElement).getPropertyValue('--text-color');
            agingScheduleChartInstance.options.plugins.legend.labels.color = getComputedStyle(document.documentElement).getPropertyValue('--text-color');
            agingScheduleChartInstance.options.plugins.title.color = getComputedStyle(document.documentElement).getPropertyValue('--text-color');
            agingScheduleChartInstance.update();
        }
    };
    darkModeToggle.addEventListener('click', updateChartColors);


    const chatbox = document.getElementById('chatbox');
    const chatLoading = document.getElementById('chatLoading');
    const openAiQuestionModalButton = document.getElementById('openAiQuestionModalButton'); // Renamed
    const transactionDescriptionInput = document.getElementById('transactionDescription');
    const generateEntryButton = document.getElementById('generateEntryButton');
    const entryLoading = document.getElementById('entryLoading');
    const generatedEntryOutput = document.getElementById('generatedEntryOutput');
    const entryAccountsDiv = document.getElementById('entryAccounts');
    const entryDescriptionP = document.getElementById('entryDescription');
    const focusModeToggle = document.getElementById('focusModeToggle');
    const focusModeOverlay = document.getElementById('focusModeOverlay');
    const focusModeClose = document.getElementById('focusModeClose');
    const focusedEntryContent = document.getElementById('focusedEntryContent');
    const aiAssistantBubble = document.getElementById('aiAssistantBubble');
    const aiAssistantLottie = document.getElementById('aiAssistantLottie');

    // AI Question Modal Elements
    const aiQuestionModal = document.getElementById('aiQuestionModal');
    const selectedTextDisplay = document.getElementById('selectedTextDisplay');
    const userQuestionInput = document.getElementById('userQuestionInput');
    const sendAiQuestionButton = document.getElementById('sendAiQuestion');
    const cancelAiQuestionButton = document.getElementById('cancelAiQuestion');


    // Lottie Animation for AI Assistant Bubble
    const animation = lottie.loadAnimation({
        container: aiAssistantLottie, // the dom element that will contain the animation
        renderer: 'svg',
        loop: true,
        autoplay: true,
        path: 'https://assets5.lottiefiles.com/packages/lf20_gwmh44.json' // Example Lottie animation URL (a simple pulsing dot)
        // You can find more animations on LottieFiles.com or create your own.
    });

    let chatHistory = [];
    let currentSelectionText = '';

    async function sendMessage(prompt) {
        console.log("sendMessage called with prompt:", prompt); // Debug log
        if (!prompt) {
            console.log("Prompt is empty, returning."); // Debug log
            return;
        }

        displayMessage(prompt, 'user');
        chatbox.scrollTop = chatbox.scrollHeight;

        chatLoading.classList.remove('hidden');
        chatbox.scrollTop = chatbox.scrollHeight;

        // Add user prompt to chat history for context
        chatHistory.push({ role: "user", parts: [{ text: prompt }] });

        const payload = { contents: chatHistory };
        console.log("API Request Payload:", JSON.stringify(payload, null, 2)); // Debug log

        // IMPORTANT: Replace "YOUR_GEMINI_API_KEY_HERE" with your actual Gemini API Key
        const apiKey = "AIzaSyAQjwaCRV8haHLBElleRJMEnZSj0o_mPTQ";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
        console.log("API URL:", apiUrl); // Debug log

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            console.log("Raw API Response:", response); // Debug log

            if (!response.ok) {
                const errorData = await response.text();
                console.error("API Response Error Status:", response.status, "Error Data:", errorData);
                displayMessage(`Error: Unable to get response from AI. Status: ${response.status}. Details: ${errorData.substring(0, 100)}...`, 'ai');
                return;
            }

            const result = await response.json();
            console.log("Parsed API Result:", result); // Debug log

            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                const text = result.candidates[0].content.parts[0].text;
                chatHistory.push({ role: "model", parts: [{ text: text }] });
                displayMessage(text, 'ai'); // Now displayMessage will handle Markdown
            } else {
                displayMessage("Sorry, I couldn't get a meaningful response from the AI. Please try again.", 'ai');
                console.warn("AI response structure unexpected:", result); // Warn if structure is off
            }
        } catch (error) {
            displayMessage("An error occurred while fetching the response. Please check your connection or try again later.", 'ai');
            console.error("AI API Fetch Error:", error); // Log error for debugging
        } finally {
            chatLoading.classList.add('hidden');
            chatbox.scrollTop = chatbox.scrollHeight;
        }
    }

    function displayMessage(message, sender) {
        const messageElement = document.createElement('div');
        messageElement.classList.add('chat-message', sender);

        if (sender === 'ai') {
            // Use marked.js to convert Markdown to HTML
            messageElement.innerHTML = marked.parse(message);
        } else {
            messageElement.textContent = message;
        }

        chatbox.appendChild(messageElement);
        chatbox.scrollTop = chatbox.scrollHeight;
    }

    // Function to handle text selection and show/hide the "Ask AI" button
    function handleSelection(event) {
        console.log('Selection event fired (mouseup or touchend).');
        const selection = window.getSelection();
        const selectedText = selection.toString().trim();

        if (selectedText.length > 0 && openAiQuestionModalButton) {
            console.log('Selected text:', selectedText);
            currentSelectionText = selectedText;
            const range = selection.rangeCount > 0 ? selection.getRangeAt(0) : null;

            if (range) {
                const rect = range.getBoundingClientRect();

                // Check if rect has valid dimensions
                if (rect.width === 0 && rect.height === 0) {
                    console.log('Selection rectangle has zero dimensions, likely empty selection.');
                    openAiQuestionModalButton.style.display = 'none';
                    currentSelectionText = '';
                    return;
                }

                // Temporarily show button to get its dimensions
                openAiQuestionModalButton.style.visibility = 'hidden';
                openAiQuestionModalButton.style.display = 'block'; // Ensure it's block to get dimensions
                const buttonWidth = openAiQuestionModalButton.offsetWidth;
                const buttonHeight = openAiQuestionModalButton.offsetHeight;
                openAiQuestionModalButton.style.visibility = 'visible';

                // Calculate desired position
                const scrollX = window.scrollX || window.pageXOffset;
                const scrollY = window.scrollY || window.pageYOffset;

                const centerX = rect.left + (rect.width / 2);
                const topPosition = rect.top + scrollY - buttonHeight - 10; // 10px offset above text
                const leftPosition = centerX + scrollX; // translateX(-50%) will center it

                console.log('Original rect:', rect);
                console.log('Button dimensions:', { width: buttonWidth, height: buttonHeight });
                console.log('Calculated top:', topPosition, 'left:', leftPosition);

                openAiQuestionModalButton.style.left = `${leftPosition}px`;
                openAiQuestionModalButton.style.top = `${topPosition}px`;
                openAiQuestionModalButton.style.display = 'block'; // Ensure it's block after positioning
                console.log('openAiQuestionModalButton display after positioning:', openAiQuestionModalButton.style.display);
            } else {
                console.log('No valid range found for selection.');
                openAiQuestionModalButton.style.display = 'none';
                currentSelectionText = '';
            }
        } else {
            if (openAiQuestionModalButton) {
                openAiQuestionModalButton.style.display = 'none';
            }
            console.log('No text selected or openAiQuestionModalButton not found.');
        }
    }

    // Function to handle clicks/taps outside the button to hide it
    function handleClickOutside(event) {
        // If the click is not on the button and not inside the modal, hide the button
        if (openAiQuestionModalButton && event.target !== openAiQuestionModalButton && !openAiQuestionModalButton.contains(event.target) &&
            aiQuestionModal && event.target !== aiQuestionModal && !aiQuestionModal.contains(event.target)) {
            openAiQuestionModalButton.style.display = 'none';
            // Do NOT clear currentSelectionText here, it will be cleared by the button click or if a new selection is made.
        }
    }

    // Event Listeners for both mouse and touch
    document.addEventListener('mouseup', handleSelection);
    document.addEventListener('touchend', handleSelection); // For mobile selection

    // When "Ask AI" button is clicked, open the modal
    openAiQuestionModalButton.addEventListener('click', (event) => {
        event.stopPropagation(); // Prevent document click from immediately hiding the button
        if (currentSelectionText) {
            selectedTextDisplay.value = currentSelectionText; // Populate selected text in modal
            userQuestionInput.value = ''; // Clear previous question
            aiQuestionModal.classList.add('active'); // Show modal
            openAiQuestionModalButton.style.display = 'none'; // Hide the floating button
            window.getSelection().removeAllRanges(); // Clear selection
        }
    });

    // Handle sending the question from the modal
    sendAiQuestionButton.addEventListener('click', () => {
        const userQuestion = userQuestionInput.value.trim();
        if (userQuestion) {
            const combinedPrompt = `Regarding the text: "${currentSelectionText}" - My question is: "${userQuestion}"`;
            sendMessage(combinedPrompt);
        } else {
            // If no specific question, just send the selected text
            sendMessage(currentSelectionText);
        }
        aiQuestionModal.classList.remove('active'); // Hide modal
        currentSelectionText = ''; // Clear selected text after use
    });

    // Handle canceling the question from the modal
    cancelAiQuestionButton.addEventListener('click', () => {
        aiQuestionModal.classList.remove('active'); // Hide modal
        currentSelectionText = ''; // Clear selected text
        window.getSelection().removeAllRanges(); // Clear selection
    });

    // Close modal if clicking outside its content
    aiQuestionModal.addEventListener('click', (event) => {
        if (event.target === aiQuestionModal) {
            aiQuestionModal.classList.remove('active');
            currentSelectionText = '';
            window.getSelection().removeAllRanges();
        }
    });


    document.addEventListener('mousedown', handleClickOutside);
    document.addEventListener('touchstart', handleClickOutside); // For mobile taps outside


    // Journal Entry Generator
    generateEntryButton.addEventListener('click', async () => {
        const transactionDescription = transactionDescriptionInput.value.trim();
        if (!transactionDescription) {
            displayMessage("Please enter a transaction description to generate a journal entry.", 'ai');
            return;
        }

        entryLoading.classList.remove('hidden');
        generatedEntryOutput.classList.add('hidden');
        entryAccountsDiv.innerHTML = '';
        entryDescriptionP.textContent = '';

        const prompt = `Generate a standard double-entry journal entry for the following transaction: "${transactionDescription}". Provide the output as a JSON array of objects. Each object should have 'accountName', 'type' (either 'debit' or 'credit'), and 'amount'. Also include a 'description' for the entire entry at the end.
        Example JSON structure:
        [
            {"accountName": "Cash", "type": "debit", "amount": 100},
            {"accountName": "Sales Revenue", "type": "credit", "amount": 100},
            {"description": "To record cash sales."}
        ]
        Ensure amounts are numeric and the description is a single string.`;

        const payload = {
            contents: [{ role: "user", parts: [{ text: prompt }] }],
            generationConfig: {
                responseMimeType: "application/json",
                responseSchema: {
                    type: "ARRAY",
                    items: {
                        type: "OBJECT",
                        properties: {
                            "accountName": { "type": "STRING" },
                            "type": { "type": "STRING", "enum": ["debit", "credit"] },
                            "amount": { "type": "NUMBER" }
                        },
                        "required": ["accountName", "type", "amount"]
                    },
                    "minItems": 2
                }
            }
        };

        // IMPORTANT: Replace "YOUR_GEMINI_API_KEY_HERE" with your actual Gemini API Key
        const apiKey = "YOUR_GEMINI_API_KEY_HERE";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const result = await response.json();

            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                const jsonString = result.candidates[0].content.parts[0].text;
                const journalEntryData = JSON.parse(jsonString);

                let description = '';
                const entryLines = [];

                journalEntryData.forEach(item => {
                    if (item.description) {
                        description = item.description;
                    } else {
                        entryLines.push(item);
                    }
                });

                entryAccountsDiv.innerHTML = '';
                entryLines.forEach(item => {
                    const row = document.createElement('div');
                    row.classList.add('account-row');
                    if (item.type === 'debit') {
                        row.innerHTML = `<span>${item.accountName}</span><span>$${item.amount.toLocaleString()}</span>`;
                    } else {
                        row.innerHTML = `<span class="credit-account">${item.accountName}</span><span>$${item.amount.toLocaleString()}</span>`;
                    }
                    entryAccountsDiv.appendChild(row);
                });
                entryDescriptionP.textContent = `(To record ${description})`;
                generatedEntryOutput.classList.remove('hidden');

            } else {
                entryAccountsDiv.innerHTML = '<p class="text-red-600">Could not generate entry. Please try a different description.</p>';
            }
        } catch (error) {
            entryAccountsDiv.innerHTML = '<p class="text-red-600">An error occurred. Please try again.</p>';
            console.error("Journal Entry API Error:", error); // Log error for debugging
        } finally {
            entryLoading.classList.add('hidden');
        }
    });

    // Focus Mode for Journal Entry
    focusModeToggle.addEventListener('click', () => {
        if (generatedEntryOutput.classList.contains('hidden')) {
            displayMessage("Please generate a journal entry first to use Focus Mode.", 'ai');
            return;
        }
        focusedEntryContent.innerHTML = generatedEntryOutput.innerHTML;
        focusModeOverlay.classList.add('active');
    });

    focusModeClose.addEventListener('click', () => {
        focusModeOverlay.classList.remove('active');
    });

    // Close focus mode if clicking outside content
    focusModeOverlay.addEventListener('click', (event) => {
        if (event.target === focusModeOverlay) {
            focusModeOverlay.classList.remove('active');
        }
    });

    // Initial setup for step buttons to ensure correct styling
    document.querySelectorAll('.step-button').forEach(button => {
        button.classList.add('bg-slate-200', 'text-slate-700');
        button.classList.remove('btn-primary'); // Ensure primary style is only for active
    });

</script>
</body>
</html>
